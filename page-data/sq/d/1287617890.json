{"data":{"allMdx":{"edges":[{"node":{"id":"84d3b4f2-6cf8-50d4-b8f1-adb0cbfb7356","tableOfContents":{"items":[{"url":"#what-should-i-do-when-i-try-to-connect-to-a-sftp","title":"What should I do when I try to connect to a SFTP.","items":[{"url":"#chose-a-client-library","title":"Chose a client library."},{"url":"#connect-to-your-sftp-server","title":"Connect to your SFTP server"}]},{"url":"#okay-so-whats-left","title":"Okay, so what's left?","items":[{"url":"#set-it-up","title":"Set it up"},{"url":"#see-it-in-action","title":"See it in action"}]}]},"excerpt":"Nowadays, it's way more likely that you'll need to connect to Buckets on some cloud provider but sometimes (and it happened to me), you might find yourself withâ€¦","body":"\nNowadays, it's way more likely that you'll need to connect to Buckets on some cloud provider but sometimes (and it happened to me),\nyou might find yourself with the need to connect to a sftp server directly. If this is your case too, I hope this article will be able to help you set that up with an awesome test coverage.\n\n## What should I do when I try to connect to a SFTP.\n\nFirst thing first, you should try to avoid doing that. If possible, you can look into how to synchronize the SFTP to a Cloud Bucket. (For example, you can look into [AWS](https://aws.amazon.com/fr/aws-transfer-family/))\n\nNow If you're still here, it might mean that this is not a choice for you. Or you're just that curious to know how that would be done directly from your application. If so you're in luck so buckle up!\n\n### Chose a client library.\n\nWhen trying to connect to a new protocol, picking up a good library is always a must.\n[SSH2](https://github.com/mscdex/ssh2) seems like the best solution out there to handle ssh (and thus sftp) workflows.\nUnfortunately, it's a bit too low level for a casual use of a sftp server (you will need to look into if if you're looking to get crafty with your sftp server but then this article won't help you anymore :D)\n\nThat is why, I would direct you to [ssh2-sftp-client](https://github.com/theophilusx/ssh2-sftp-client). A simple wrapper that provide a usable promise API over ssh2.\n\n### Connect to your SFTP server\n\nThis is the easy part of all of this.\n\nLet's start by getting our package.json in order\n\n```shell\nnpm install ssh2-sftp-client\n\nyarn add ssh2-sftp-client\n```\n\nAnd then in the place you need to connect to the sftp server just go with something along the line of\n\n```typescript\nimport Client from \"ssh2-sftp-client\";\n\nconst client = new Client();\nawait client.connect({\n  host: \"127.0.0.1\", // You sftp server IP address\n  port: 9999, // You sftp server port\n  username: \"test\", // Your username\n  password: \"test\", // You can also opt in for private key authentication\n});\n```\n\nOnce connected, you can do most operation that you'd like to using the client\n\n```typescript\n// Write \"Content\" in a file on the server\nawait client.put(Buffer.from(\"Content\"), \"/directory/filename.extension\");\n\n// Get back the content of the file\nconst content = await client.get(\"/directory/filename.extension\");\n\n// List all files in a directory\nconst files = await client.list(\"/directory\");\n```\n\nIf you're not familiar with SFTP, you could give the ssh2 documentation to get an overview of the available commands [here](https://github.com/mscdex/ssh2/blob/master/SFTP.md)\n\n## Okay, so what's left?\n\nIf you're building a quick POC then you're all set but if you're trying to add this to an application, you're probably wondering how you're going to make your test suite run smoothly.\nIf you're only doing unit tests, you can probably get away by mocking the client library but if you also want some integration/e2e tests, you might want to setup a sftp server to respond to your client calls.\n\nI would argue that you have two main choices to do this\n\n- Look for a docker image of a sftp server, understand it's configuration and add it to both your local env and the CI setup.\n- Install and a library that I built specially for this -> [sftp-mock-server](https://github.com/MollardMichael/sftp-mock-server)\n\n### Set it up\n\n```shell\nnpm install --save-dev @micham/sftp-mock-server\n\nyarn add -D @micham/sftp-mock-server\n```\n\n### See it in action\n\n```typescript\ndescribe(\"MySFTPClient\", () => {\n  let mockServer: Server;\n  beforeEach(async () => {\n    mockServer = await createSftpMockServer({\n      port: \"9999\",\n      hostname: \"127.0.0.1\",\n      debug: (msg: string) => logger.debug(msg),\n    });\n  });\n\n  afterEach(async () => {\n    await closeServer(mockServer);\n  });\n\n  it(\"should be able to write file to the SFTP server\", () => {\n    // GIVEN\n    const client = new MySFTPClient();\n\n    // WHEN\n    const result = client.doMyThingUsingSftp();\n\n    // THEN check result\n  });\n});\n```\n","frontmatter":{"type":"Blog","image":{"publicURL":"/static/17e75d0264a682ef1c93a3e5a0f7eefa/sftp.svg","childImageSharp":null},"tags":["sftp","typescript","tests"],"title":"Ever wondered how to connect to a sftp directly from your typescript application?","path":"/blog/sftp-mock-server","date":"Oct 2022"}}},{"node":{"id":"2752e7bb-3154-59a2-b57d-1b4a4a35353b","tableOfContents":{},"excerpt":"","body":"","frontmatter":{"type":"Blog","image":{"publicURL":"/static/aa90c5081f79ac934c3b5e0f47f01b85/hero.png","childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB8klEQVQoz4WSS09TURSF+TnGiFpKW41JTRqiM40xDjQOnDthoAMTBgx8l5gw04EkkmDShhgrffC2LfTcW0pbmrbntqUFraC0RqAYqiLxM/daQZCUwc4ZrHO+vdY+u8WqKfxbFimM0ywFJ7MRrFJg0RROawL77FvOpsI48iod87GGJva8b9kP1KtdCuy5KJeKCaxZQVtR4cbABL0Po9x1CrofjXN1TsWcVw1oU+ApTeFIZopn1TLvvtcx6e7mQjh7k/R1Qn/3Fk96VM5lhaHZ5G6q/4C6YNMUI+q1hRS33mvYF2NcDEzS37PEi3u/eN71mU53COti1HC/39Ae4F/Yhfk4Dz6V6MjNYMoL7vtUqoUtVla2mfQUuDMyirkUxaY7OyxymxQ48jM4P5a4Uk7jUCcQapmvG9+orFUIe8K8jLyhNaceDtyZhRQck4Iz2RDugJfVYoXND8usflknNT7MZTnFcWN+fzbgYGBD1C+ZNYUTuSjekBsZjEJ9EzaqZLQllgNubhb0hkpzh5YGtF3/aSkYTI3B9CA/FlKkExpDo2l8A37qcT/Xs7sOrc0c6qBWTeGVDot5+JnwQz7C466nHDXdZqzPRU2OYM9EjBTWZkC9m75X52WEWtwHcS/bs0PUgi7Wgy7Wpl9D0o+aHN5JcxDwN/PxinjAQvTaAAAAAElFTkSuQmCC","aspectRatio":1.9047619047619047,"src":"/static/aa90c5081f79ac934c3b5e0f47f01b85/ee604/hero.png","srcSet":"/static/aa90c5081f79ac934c3b5e0f47f01b85/69585/hero.png 200w,\n/static/aa90c5081f79ac934c3b5e0f47f01b85/497c6/hero.png 400w,\n/static/aa90c5081f79ac934c3b5e0f47f01b85/ee604/hero.png 800w,\n/static/aa90c5081f79ac934c3b5e0f47f01b85/f3583/hero.png 1200w","sizes":"(max-width: 800px) 100vw, 800px"}}},"tags":["graphql","typescript","tests"],"title":"Leverage Graphql and typescript for easy mocking","path":"/blog/graphql-mocks-type-level","date":"Oct 2022"}}}]}}}